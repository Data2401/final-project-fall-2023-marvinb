---
title: "Data 2401 Final Project"
author: "Marvin Bernardino"
date: "2023-11-06"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Texas Wide Open
Data 2401 Final Project

## Introduction

In 2013, Gov. Rick Perry launched the "Texas Wide Open For Business" campaign. Advertising campaigns were launched in major cities across California to lure them into moving to Texas (Texas Monthly, 2013).

In 2023, some Texans and other national figures are now blaming both California and these new migrants for whatever local problems these migrations may have caused.

Using some publicly available data, we will now try to answer whether these concerns are overblown or not.

## Data

The IRS publishes a yearly U. S. Population Migration Data (IRS, 2023). Every year, as taxes are filed, the IRS takes notes on address changes that tax filers report on their own income tax returns. 

The data normally includes:

- number of returns filed (approximates the number of households)
- number of personal exemptions claimed (approximates the number of invididuals)
- total adjusted gross income

The data is usually prepared year to year, which means it will take a lot of work to combine these data into bigger data sets, if year-to-year changes are to be analyzed.

Conveniently, user Patrick O'Connor in Kaggle, published a data set containing data from 1992 to 2020. 

## Kaggle Data by Patrick O'Connor

Patrick O'Connor's dataset, uploaded in Kaggle, is a collection of IRS Migration Data from 1992 to 2020. The IRS dataset, however, starts in 1990 and also includes the counties from which the migrants moved from and their destination. The IRS dataset is massive but is only collected and reported on a yearly basis. Patrick O'Connor combined these datasets from 1993 to 2020 but removed the county codes. 

Note that the IRS only begun including AGI data in 1993. Hence, there will be no AGI figures to be reported before that year (IRS, 2023). Essentially, the data begins in 1993, and the tax filers have now moved and filed their taxes by that year. 

The O'Connor dataset contains 9 fields, most of whom are state codes and abbreviations. The important fields include:

- Y1 (the year when the individual filed their last tax return)

- Y1_STATE_NAME (name of the state where the individual filed their last return)

- Y2 (the year when the individual filed their current tax return)

- Y2_STATE_NAME (name of the state the filer currently reside in)

- NUM_RETURNS (number of tax returns, approximates household)

- NUM_EXEMPTIONS (number of exemptions claimed, approximates number of individuals)

- AGI (adjusted gross income, the AGI represents the total income of all individuals who moved that particular year)

## Problems /  Objectives

The dataset will now show migration patterns year to year, including the number of households and number of individuals migrating to any state, and their household income.

We can now ask:

- How many individuals are migrating to Texas from California?

- What is the household income of these migrants?

- Was Gov. Rick Perry's advertising campaign effective?

- What other information can be gleamed from these data?

## Packages Used

```{r message=FALSE}
library(tidyverse)
library(ggplot2)
```


## Raw Data

```{r, echo=FALSE}

irs_SOI_state_migraion_data <- read.csv("irs_SOI_state_migraion_data.csv")
glimpse(irs_SOI_state_migraion_data)
```

The O'Connor Kaggle Data is still arranged year to year, with each state, starting at Y1_STATE..., with an accompanying Y2_STATE.... Note that Y1_STATE and Y2_STATE can be equal, which means that these are the tax filers who did not move to another state. 

FIPS codes stand for Federal Information Processing System Codes for States and Counties. The number uniquely identify geographic areas, for example, the state-level FIPS code for Texas is 48 (Federal Communications Commission). The O'Connor Dataset retained the state-level FIPS code but excluded the county-level FIPS codes. Hence, this report is currently limited to only analyzing state-level migration.

The AGI stands for aggregate gross income, and is reported in the thousands. This means that to obtain the true AGI in dollars, they have to be multiplied by 1000.

Each line in the data includes Y1 (previous year), Y2 (current year), Y1_State_x (previous state), Y2_State_x (current state), NUM_RETURNS (number of tax returns filed in Y2), AGI (the total income of all the filers in NUM_RETURNS).

## California to Texas Migration Data, 1993 to 2020

To obtain migration data from California to Texas, we use Y1_STATE_ABBR = "CA" and Y2_STATE_ABBR == "TX"


```{r, echo=FALSE}
#filter California to Texas Data
CATXdata <- irs_SOI_state_migraion_data %>% filter(Y1_STATE_ABBR == "CA" & Y2_STATE_ABBR == "TX")

CATXdata <- CATXdata %>% select(Year = Y2, Californians = NUM_EXEMPTIONS, AGI, NUM_RETURNS)

CATXdata
```
# Graph of California Migration to Texas

```{r}
#CATXdata <- CATXdata %>% mutate_at(c('Year'), as.factor)
options(scipen = 999)

#plot of California to Texas Data

ggplot(CATXdata, aes(Year, Californians)) + geom_point() + geom_line() + geom_vline(xintercept = 2013, linetype="dotted", color = "blue") + annotate(geom = "text", x = 2013, y = 100000, label = "2013") + theme_bw()

```

At least 40,000 Californians are moving to Texas, yearly. In 2020, more than 100,000 Californians moved to Texas. Note that there is a drop in migration around 2015, but Californians have been migrating steadily in increasing numbers since 2004.

## Texas vs. California Migration Data, 1992 to 2020

```{r, echo=FALSE}
knitr::opts_chunk$set(echo = FALSE, out.width = '100%')

#filter Texas to California Data, Y1
TXCAdata <- irs_SOI_state_migraion_data %>% filter(Y1_STATE_ABBR == "TX" & Y2_STATE_ABBR == "CA")

TXCAdata <- TXCAdata %>% select(Year = Y2, Texans = NUM_EXEMPTIONS, AGI, NUM_RETURNS)

#take out only CA to TX data for Graph 2
G2_CAdata <- CATXdata %>% select(Year, Californians)

#take out only TX to CA data for graph 2
G2_TXdata <- TXCAdata %>% select(Year, Texans)

#combine G2_CA to G2_TX dor graphing
G2_Data <- inner_join(G2_CAdata, G2_TXdata, by = join_by(Year))

options(scipen = 999)

G2_Data <- G2_Data %>% mutate_at(c('Year'), as.factor)


#plot of Texans leaving California with G1 at background

ggplot(G2_Data, aes(Year, Texans, group = 2)) + geom_line(color = "firebrick") + geom_line(aes(y=Californians), color = "dodgerblue3") + annotate(geom = "text", x = 8, y = 60000, label = "Californians Moving to Texas", color = "dodgerblue3") +  annotate(geom = "text", x = 5, y = 38000, label = "Texans Moving to California", color = "firebrick") + labs(y = "Number of Migrants") + theme_bw(base_size = 8)

```

Note that net migration between California and Texas favors California migration to Texas.

## Top 3 Destinations for California Migrants, 1993 to 2020.

```{r, echo=FALSE, message=FALSE}
knitr::opts_chunk$set(echo = FALSE, out.width = '100%')

TOP3 <- irs_SOI_state_migraion_data %>% filter(Y1_STATE_ABBR == "CA" & Y2_STATE_ABBR != "CA") %>% group_by(Y2) %>%  top_n(n=3, NUM_EXEMPTIONS) %>% select(State = Y2_STATE_NAME, NUM_EXEMPTIONS)

TOP3 <- TOP3 %>% mutate_at(c('Y2'), as.factor)

ggplot(TOP3, aes(x = forcats::fct_rev(Y2), NUM_EXEMPTIONS, fill = State)) + geom_col(position = "dodge") + coord_flip() + labs(y = "Number of Migrants", x = "Year") + theme_bw()

```
Note that Californians began moving to Texas in greater numbers starting in 2004.


## Top Destinations of Texas Migrants
```{r}
#without texans
sansTEXANS <- irs_SOI_state_migraion_data %>% filter(Y1_STATE_ABBR == "TX" & Y2_STATE_ABBR != "TX") %>% select(Y2, State = Y2_STATE_NAME, NUM_EXEMPTIONS)

sansTEXANS <- sansTEXANS %>% group_by(Y2) %>% mutate(TotalnotTX = sum(NUM_EXEMPTIONS))


sansTEXANS <- sansTEXANS %>% group_by(Y2) %>% mutate(Percent_Migration = (NUM_EXEMPTIONS / TotalnotTX ) ) %>% top_n(n=5, Percent_Migration)

ggplot(sansTEXANS, aes(x = Y2, y = Percent_Migration, fill = State)) + geom_col() + scale_y_continuous(labels = scales::percent) + facet_wrap(.~State) + labs(y= "Percent Migrants", x = "Year")

```
Note that a significant population of Texans leave for a foreign counties, from 1990s to 2010


## Non-migrant Population of Texans

```{r}
allTEXANS <- irs_SOI_state_migraion_data %>% filter(Y1_STATE_ABBR == "TX") %>% select(Y2, State = Y2_STATE_NAME, NUM_EXEMPTIONS)

allTEXANS <- allTEXANS %>% group_by(Y2) %>% mutate(TotalTX = sum(NUM_EXEMPTIONS))

allTEXANS <- allTEXANS %>% mutate_at(c('Y2'), as.factor)

allTEXANS <- allTEXANS %>% group_by(Y2) %>% mutate(Percent_Migration = (NUM_EXEMPTIONS / TotalTX ) * 100) %>% top_n(n=1, Percent_Migration)

allTEXANS %>% select(Year = Y2, Percent_Migration)
  
ggplot(allTEXANS, aes(x = Y2, y = Percent_Migration, group = State, fill = State)) + geom_col()  + theme_bw(base_size = 8) + labs(y= "Percent Population", x = "Year") + geom_hline(yintercept = 97, linetype="solid", color = "blue") + annotate(geom = "text", x = 10, y = 97.2, label = "97%", color = "blue")
```
Between 2-3% of Texans migrate annually for other states.

## Top Destinations for California Migrants

```{r}
#without Californians
sansCAL <- irs_SOI_state_migraion_data %>% filter(Y1_STATE_ABBR == "CA" & Y2_STATE_ABBR != "CA") %>% select(Y2, State = Y2_STATE_NAME, NUM_EXEMPTIONS)

sansCAL <- sansCAL %>% group_by(Y2) %>% mutate(TotalnotCA = sum(NUM_EXEMPTIONS))


sansCAL <- sansCAL %>% group_by(Y2) %>% mutate(Percent_Migration = (NUM_EXEMPTIONS / TotalnotCA ) ) %>% top_n(n=5, Percent_Migration)

ggplot(sansCAL, aes(x = Y2, y = Percent_Migration, fill = State)) + geom_col() + scale_y_continuous(labels = scales::percent) + facet_wrap(.~State) + labs(y= "Percent Migrants", x = "Year")
```
Texas features prominently as the top destination for California migrants, with at least 9% migrating annually. Foreign migration is also a feature, but to a lesser degree than Texas.

## Non-migrant Population of California

```{r}
allCA <- irs_SOI_state_migraion_data %>% filter(Y1_STATE_ABBR == "CA" ) %>% select(Y2, State = Y2_STATE_NAME, NUM_EXEMPTIONS)

allCA <- allCA %>% group_by(Y2) %>% mutate(TotalCA = sum(NUM_EXEMPTIONS))

allCA <- allCA %>% mutate_at(c('Y2'), as.factor)

allCA <- allCA %>% group_by(Y2) %>% mutate(Percent_Migration = (NUM_EXEMPTIONS / TotalCA ) * 100) %>% top_n(n=1, Percent_Migration)

allCA %>% select(Year = Y2, Percent_Migration)
  
ggplot(allCA, aes(x = Y2, y = Percent_Migration, group = State, fill = State)) + geom_col()  + theme_bw(base_size = 8) + labs(y= "Percent Population", x = "Year") + geom_hline(yintercept = 97, linetype="solid", color = "blue") + annotate(geom = "text", x = 10, y = 97.2, label = "97%", color = "blue")

```

Both California and Texas have similar levels of migration -- 97-98% do not migrate.


## Top State Migrants Moving to Texas

```{r}
TXmovers <- irs_SOI_state_migraion_data %>% filter(Y2_STATE_ABBR == "TX" & Y1_STATE_ABBR != "TX") %>% select(Y2, State = Y1_STATE_NAME, NUM_EXEMPTIONS)

TXmovers <- TXmovers %>% group_by(Y2) %>% mutate(Totalmovers = sum(NUM_EXEMPTIONS))


TXmovers <- TXmovers %>% group_by(Y2) %>% mutate(Percent_Migration = (NUM_EXEMPTIONS / Totalmovers ) ) %>% top_n(n=9, Percent_Migration)

ggplot(TXmovers, aes(x = Y2, y = Percent_Migration, fill = State)) + geom_col() + scale_y_continuous(labels = scales::percent) + facet_wrap(.~State) + labs(y= "Percent Migrants", x = "Year")

```
Notice the jump in Louisiana in the mid-2000's,

## Louisiana Migrants moving to Texas, A Closer Look

```{r}
LA2006 <- TXmovers %>% filter(State == "LOUISIANA")



ggplot(LA2006, aes(x = Y2, y= NUM_EXEMPTIONS, fill = State)) + geom_col(fill='tan', color = 'black') + 
  labs(y= "Number of Migrants", x = "Year") +
  geom_vline(xintercept = 2006, linetype="longdash", color = 'black' ) + 
  annotate(geom = "text", x = 2008, y = 70000, label = "2006", color = 'black' ) 

  
```
Hurricane Katrina made landfall in New Orleans, Louisiana on August 29, 2005 (National Weather Service, 2022)

## References


Internal Revenue Service. (2023, April 27). *SOI Tax Stats - Migration Data.* Tax Statistics. https://www.irs.gov/statistics/soi-tax-stats-migration-data 

Federal Communications Commision. (2023). *States and Counties FIPS codes*. https://transition.fcc.gov/oet/info/maps/census/fips/fips.txt


Herzog, M., Texas Monthly Staff. (2013, February 5). *Rick Perry to Californians: Come Check Out Texas.* Texas Monthly.  https://www.texasmonthly.com/news-politics/rick-perry-to-californians-come-check-out-texas/

O'Connor, P. (2023, September). *IRS Migration Data - 1992 to 2020.* kaggle. https://www.kaggle.com/datasets/wumanandpat/irs-migration-data-1992-to-2020

National Weather Service. (2022, September). *Hurricane Katrina - August 2005.* National Oceanic and Atmospheric Administration. https://www.weather.gov/mob/katrina

Bureau of Labor Statistics. (2023, November). *Average CPI by Quarter and Year*. Social Security Administration. https://www.ssa.gov/oact/STATS/avgcpi.html

Federal Reserve Economic Data, St. Louis FED. (2023, November). *Median Household Income in California*. Economic Research, Federal Reserve Bank of St. Louis. https://fred.stlouisfed.org/series/MEHOINUSCAA646N

Federal Reserve Economic Data, St. Louis FED. (2023, November). *Median Household Income in Texas*. Economic Research, Federal Reserve Bank of St. Louis. https://fred.stlouisfed.org/series/MEHOINUSTXA646N
